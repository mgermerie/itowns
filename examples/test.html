<html>
    <head>
        <title>Test tiff</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" type="text/css" href="css/example.css">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.6/dat.gui.min.js"></script>
    </head>
    <body>
        <div id="viewerDiv"></div>

        <script src="../dist/itowns.js"></script>
        <script src="../dist/debug.js"></script>
        <script src="js/GUI/GuiTools.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/geotiff"></script>

        <script type="text/javascript">
            console.log(debug);

            // ---------- DIFFERENT TEST DATASET : ----------

            // SIS data
            const data = {
                coord: new itowns.Coordinates('EPSG:4326', -1.08, 13.082),
                source: {
                    extent: new itowns.Extent('EPSG:4326', -2.57046, 2.80335, 0.3839, 15.0937),
                    // name: 'toto:W002N13_4EGTFLT32_MTNE1_001',
                    name: 'toto:COVERAGE_SIS',
                    url: 'http://localhost:8080/geoserver/toto/wms',
                    version: '1.3.0',
                    //noDataValue: -32.767,
                },
            };

            // Lidar HD data
            // const data = {
            //     coord: new itowns.Coordinates('EPSG:4326', -0.926061837, 45.988156177),
            //     source: {
            //         extent: new itowns.Extent('EPSG:4326', -1.57046, 2.80335, 45.3839, 51.0937),
            //         name: 'IGNF_LIDAR-HD_MNS',
            //         url: 'https://data.geopf.fr/wms-r',
            //         version: '1.3.0',
            //     },
            //     noDataValue: -999999,
            // };



            // ---------- CREATE THE VIEW : ----------

            const placement = { coord: data.coord, range: 20000 };
            const viewerDiv = document.getElementById('viewerDiv');
            const view = new itowns.GlobeView(viewerDiv, placement);
            const debugMenu = new GuiTools('menuDiv', view);

            itowns.Fetcher.json('./layers/JSONLayers/OPENSM.json').then(function _(config) {
                config.source = new itowns.TMSSource(config.source);
                view.addLayer(
                    new itowns.ColorLayer('Map', config),
                ).then(
                    debugMenu.addLayerGUI.bind(debugMenu)
                );
            });

            debug.createTileDebugUI(debugMenu.gui, view);


            // ---------- DISPLAY TIFF AS COLORLAYER : ----------

            const tifSource = new itowns.WMSSource({
                ...data.source,
                crs: 'EPSG:4326',
                format: 'image/geotiff',
            });

            // const tifLayer = new itowns.ColorLayer('tiff', {
            //     source: tifSource,
            // });
            // view.addLayer(tifLayer);

            view.addLayer(
                new itowns.ElevationLayer(
                    'tiff',
                    {
                        source: tifSource,
                        noDataValue: data.noDataValue,
                    },
                ),
            ).then(
                debugMenu.addLayerGUI.bind(debugMenu),
            );

        </script>
    </body>
</html>
