<!DOCTYPE html>
<html>
    <head>
        <title>Itowns - 3d-tiles example</title>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" type="text/css" href="css/example.css">
        <link rel="stylesheet" type="text/css" href="css/LoadingScreen.css">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.6/dat.gui.min.js"></script>
    </head>
    <body>
        <div id="viewerDiv"></div>

        <!-- Import iTowns source code -->
        <script src="../dist/itowns.js"></script>
        <script src="../dist/debug.js"></script>
        <!-- Import iTowns LoadingScreen and GuiTools plugins -->
        <script src="js/GUI/GuiTools.js"></script>
        <script src="js/GUI/LoadingScreen.js"></script>


        <script type="text/javascript">


            // ---------- CREATE A GlobeView FOR SUPPORTING DATA VISUALIZATION : ----------

            // Define camera initial position
            const placement = {
                coord: new itowns.Coordinates(
                    "EPSG:4326",
                    48.273914,
                    42.053133,
                    0,
                ),
                range: 4000,
                tilt: 22,
                heading: 180,
            }

            // `viewerDiv` will contain iTowns' rendering area (`<canvas>`)
            const viewerDiv = document.getElementById('viewerDiv');

            // Create a GlobeView
            const view = new itowns.GlobeView(viewerDiv, placement);

            // Setup loading screen and debug menu
            setupLoadingScreen(viewerDiv, view);
            const debugMenu = new GuiTools('menuDiv', view);



            // ---------- DISPLAY MAP : ----------

            const tmsSource = new itowns.TMSSource({
                format: "image/png",
                crs: "EPSG:3857",
                url: "https://tile.openstreetmap.org/${z}/${x}/${y}.png",
                tileMatrixSet: "PM",
            });

            const colorLayer = new itowns.ColorLayer("OPENSM", {
                source: tmsSource,
            });

            view.addLayer(colorLayer)
                .then(() => {
                    debugMenu.addLayerGUI.bind(debugMenu);
                    itowns.ColorLayersOrdering.moveLayerToIndex(
                        view,
                        "OPENSM",
                        10,
                    );
                });



            // ---------- DISPLAY 3d tiles MODEL : ----------

            itowns.enableDracoLoader("./libs/draco/");

            const extensions = new itowns.C3DTExtensions();
            extensions.registerExtension(
                "3DTILES_batch_table_hierarchy",
                {
                    [itowns.C3DTilesTypes.batchtable]:
                    itowns.C3DTBatchTableHierarchyExtension,
                },
            );

            const threeDTilesIonSource = new itowns.C3DTilesIonSource({
                accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9."
                    + "eyJqdGkiOiIwYmFjMzFkNS05M2QwLTQ1OGQtYjVkMi03"
                    + "YjVhYzY2NjI4NjgiLCJpZCI6NjkwMTksImlhdCI6MTYz"
                    + "MzA0NjI4N30.z8PZB6uBWIbRpALYj-mrSCLMQkKbRiQrz2Xle4jq9CA",
                assetId: 2386694,
            });

            const threeDTilesIonLayer = new itowns.C3DTilesLayer(
                "3d-tiles-cesium-ion",
                {
                    name: "3D Tiles from Cesium Ion",
                    source: threeDTilesIonSource,
                    registeredExtensions: extensions,
                },
                view,
            );

            itowns.View.prototype.addLayer.call(view, threeDTilesIonLayer);



            // ---------- DEBUG TOOLS : ----------

            // debug.createTileDebugUI(debugMenu.gui, view);
            debug.create3dTilesDebugUI(
                debugMenu.gui,
                view,
                threeDTilesIonLayer,
            );



        </script>
    </body>
</html>
